{"ast":null,"code":"var _jsxFileName = \"/home/rlyz/wdi/sei-24-project-3/client/src/Components/User/TimeLine/TimeLine.js\";\nimport React, { Component } from 'react';\nimport EachMerchant from './EachMerchant/EachMerchant';\nimport OrderHistory from '../OrderHistory/OrderHistory';\nimport { Route, Link, Redirect, Switch } from 'react-router-dom';\nimport IndivListing from '../IndivStore/IndivListing';\nimport ListingContainer from '../IndivStore/ListingContainer';\nvar fetching = true;\nexport default class TimeLine extends Component {\n  constructor(props) {\n    super();\n\n    this.testing = prop => {\n      if (fetching === true) {\n        fetching = false;\n        setTimeout(() => {\n          console.log(`fetching new list soon`);\n          fetch('/timeline').then(res => res.json()).then(res => {\n            console.log(res, `fetched`);\n            fetching = true;\n            this.setState({\n              timeLine: res,\n              fetch: !this.state.fetch\n            });\n          });\n        }, 5000);\n        setTimeout(() => {\n          console.log(`fetching deleted list soon`);\n          fetch('/deletedlisting').then(res => res.json()).then(res => {\n            res.sort(function (a, b) {\n              const uploadTimeA = new Date(a.time);\n              const uploadTimeB = new Date(b.time);\n              return uploadTimeB - uploadTimeA;\n            });\n            let result = res.slice(0, 5);\n            this.setState({\n              deletedArray: result\n            });\n          });\n        }, 5000);\n        setTimeout(() => {\n          let defunctArray = this.state.timeLine.map((item, index) => {\n            const uploadTime = new Date(item.time);\n            uploadTime.setMinutes(uploadTime.getMinutes() + item.time_limit_min);\n            let difference = +uploadTime - +new Date();\n\n            if (difference < 0) {\n              return item;\n            }\n          });\n          let newArray = defunctArray.filter(item => {\n            return item;\n          });\n          console.log(`deleting soon`);\n          fetch('/tidyuplisting', {\n            method: 'POST',\n            headers: {\n              'Content-Type': 'application/json'\n            },\n            body: JSON.stringify({\n              toBeDeleted: newArray\n            })\n          }).then(res => res.text()).then(res => {\n            console.log(res);\n          });\n        }, 10000);\n      }\n    };\n\n    this.state = {\n      timeLine: [],\n      deletedArray: [],\n      fetch: true\n    };\n  }\n\n  componentDidMount() {\n    fetch('/timeline').then(res => res.json()).then(res => {\n      // console.log(res);\n      this.setState({\n        timeLine: res,\n        newTimeLine: res\n      });\n    });\n    fetch('/deletedlisting').then(res => res.json()).then(res => {\n      console.log(res);\n      res.sort(function (a, b) {\n        const uploadTimeA = new Date(a.time);\n        const uploadTimeB = new Date(b.time);\n        return uploadTimeB - uploadTimeA;\n      });\n      this.setState({\n        deletedArray: res\n      });\n    });\n  }\n\n  render() {\n    let newArray = this.state.timeLine.map((item, index) => {\n      const uploadTime = new Date(item.time);\n      uploadTime.setMinutes(uploadTime.getMinutes() + item.time_limit_min);\n      let difference = +uploadTime - +new Date();\n\n      if (difference > 0) {\n        return item;\n      }\n    });\n    let newerArray = newArray.filter(item => {\n      return item;\n    });\n    newerArray.sort(function (a, b) {\n      const uploadTimeA = new Date(a.time);\n      uploadTimeA.setMinutes(uploadTimeA.getMinutes() + a.time_limit_min);\n      const uploadTimeB = new Date(b.time);\n      uploadTimeB.setMinutes(uploadTimeB.getMinutes() + b.time_limit_min);\n      return uploadTimeA - uploadTimeB;\n    }); // console.log(newerArray, `before splice`)\n\n    if (newerArray.length > 20) {\n      newerArray.splice(19, newerArray.length - 20);\n    } // console.log(newerArray, `After splice`)\n\n\n    let merchantCard = newerArray.map((eachCard, index) => {\n      const discount = (eachCard.unit_price - eachCard.price_floor) / eachCard.unit_price * 100;\n      let path = \"/\" + eachCard.merchant_id;\n      return /*#__PURE__*/React.createElement(Link, {\n        to: path,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 139,\n          columnNumber: 20\n        }\n      }, /*#__PURE__*/React.createElement(EachMerchant, {\n        key: index,\n        duration: eachCard.time_limit_min,\n        listing: eachCard.listing_id,\n        time: eachCard.time,\n        merchant_Id: eachCard.merchant_id,\n        what: this.testing,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 141,\n          columnNumber: 17\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 142,\n          columnNumber: 21\n        }\n      }, index, eachCard.name), /*#__PURE__*/React.createElement(\"div\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 143,\n          columnNumber: 21\n        }\n      }, \"up to\", discount, \"%\")));\n    });\n    let deletedMerchantCard = this.state.deletedArray.map((eachCard, index) => {\n      const discount = (eachCard.unit_price - eachCard.price_floor) / eachCard.unit_price * 100;\n      let path = \"/\" + eachCard.merchant_id;\n      return /*#__PURE__*/React.createElement(Link, {\n        to: path,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 152,\n          columnNumber: 20\n        }\n      }, /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"div\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 155,\n          columnNumber: 21\n        }\n      }, eachCard.Merchant), /*#__PURE__*/React.createElement(\"div\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 156,\n          columnNumber: 21\n        }\n      }, index, eachCard.name), /*#__PURE__*/React.createElement(\"div\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 157,\n          columnNumber: 21\n        }\n      }, \"up to\", discount, \"%\")));\n    });\n    const routeArray = newerArray.map((eachCard, index) => {\n      let path = \"/\" + eachCard.merchant_id;\n      return /*#__PURE__*/React.createElement(Route, {\n        path: path,\n        render: () => /*#__PURE__*/React.createElement(ListingContainer, {\n          merchant_id: eachCard.merchant_id,\n          stripper: this.props.stripper,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 166,\n            columnNumber: 23\n          }\n        }),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 165,\n          columnNumber: 20\n        }\n      });\n    });\n    return /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 170,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"navbar\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 171,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 172,\n        columnNumber: 21\n      }\n    }, \"Image here\"), /*#__PURE__*/React.createElement(Link, {\n      className: \"login break\",\n      to: \"/Timeline\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 173,\n        columnNumber: 21\n      }\n    }, \"Timeline\"), /*#__PURE__*/React.createElement(Link, {\n      className: \"login break\",\n      to: \"/Orderhistory\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 174,\n        columnNumber: 21\n      }\n    }, \"Order history\")), /*#__PURE__*/React.createElement(\"main\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 176,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(Switch, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 177,\n        columnNumber: 21\n      }\n    }, routeArray, /*#__PURE__*/React.createElement(Route, {\n      path: \"/Orderhistory\",\n      render: () => /*#__PURE__*/React.createElement(OrderHistory, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 180,\n          columnNumber: 35\n        }\n      }),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 179,\n        columnNumber: 25\n      }\n    }), /*#__PURE__*/React.createElement(Route, {\n      path: \"/\",\n      render: () => /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"div\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 183,\n          columnNumber: 37\n        }\n      }, merchantCard), /*#__PURE__*/React.createElement(\"div\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 184,\n          columnNumber: 33\n        }\n      }, deletedMerchantCard)),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 182,\n        columnNumber: 25\n      }\n    }))));\n  }\n\n}","map":{"version":3,"sources":["/home/rlyz/wdi/sei-24-project-3/client/src/Components/User/TimeLine/TimeLine.js"],"names":["React","Component","EachMerchant","OrderHistory","Route","Link","Redirect","Switch","IndivListing","ListingContainer","fetching","TimeLine","constructor","props","testing","prop","setTimeout","console","log","fetch","then","res","json","setState","timeLine","state","sort","a","b","uploadTimeA","Date","time","uploadTimeB","result","slice","deletedArray","defunctArray","map","item","index","uploadTime","setMinutes","getMinutes","time_limit_min","difference","newArray","filter","method","headers","body","JSON","stringify","toBeDeleted","text","componentDidMount","newTimeLine","render","newerArray","length","splice","merchantCard","eachCard","discount","unit_price","price_floor","path","merchant_id","listing_id","name","deletedMerchantCard","Merchant","routeArray","stripper"],"mappings":"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","sourcesContent":["import React, { Component } from 'react'\nimport EachMerchant from './EachMerchant/EachMerchant'\nimport OrderHistory from '../OrderHistory/OrderHistory'\nimport { Route, Link, Redirect, Switch } from 'react-router-dom'\nimport IndivListing from '../IndivStore/IndivListing'\nimport ListingContainer from '../IndivStore/ListingContainer'\n\nvar fetching = true\n\nexport default class TimeLine extends Component {\n    constructor(props) {\n        super()\n        this.state = {\n            timeLine: [],\n            deletedArray: [],\n            fetch: true\n        }\n    }\n    componentDidMount() {\n        fetch('/timeline')\n            .then(res => res.json())\n            .then(res => {\n                // console.log(res);\n                this.setState({\n                    timeLine: res,\n                    newTimeLine: res\n                })\n            })\n\n        fetch('/deletedlisting')\n            .then((res) => res.json())\n            .then((res) => {\n                console.log(res)\n                res.sort(function (a, b) {\n                    const uploadTimeA = new Date(a.time)\n                    const uploadTimeB = new Date(b.time)\n                    return uploadTimeB - uploadTimeA\n                })\n                this.setState({\n                    deletedArray: res\n                })\n            })\n\n    }\n\n    testing = (prop) => {\n\n        if (fetching === true) {\n            fetching = false\n            setTimeout(() => {\n                console.log(`fetching new list soon`)\n                fetch('/timeline')\n                    .then(res => res.json())\n                    .then(res => {\n                        console.log(res, `fetched`)\n                        fetching = true\n                        this.setState({\n                            timeLine: res,\n                            fetch: !this.state.fetch\n                        })\n                    })\n            }, 5000)\n\n            setTimeout(() => {\n                console.log(`fetching deleted list soon`)\n                fetch('/deletedlisting')\n                    .then((res) => res.json())\n                    .then((res) => {\n                        res.sort(function (a, b) {\n                            const uploadTimeA = new Date(a.time)\n                            const uploadTimeB = new Date(b.time)\n                            return uploadTimeB - uploadTimeA\n                        })\n                        let result = res.slice(0, 5)\n                        this.setState({\n                            deletedArray: result\n                        })\n                    })\n            }, 5000)\n\n            setTimeout(() => {\n                let defunctArray = this.state.timeLine.map((item, index) => {\n                    const uploadTime = new Date(item.time)\n                    uploadTime.setMinutes(uploadTime.getMinutes() + item.time_limit_min)\n                    let difference = +uploadTime - +new Date();\n                    if (difference < 0) {\n                        return item\n                    }\n                })\n                let newArray = defunctArray.filter((item) => {\n                    return item\n                })\n                console.log(`deleting soon`)\n                fetch('/tidyuplisting', {\n                    method: 'POST',\n                    headers: {\n                        'Content-Type': 'application/json'\n                    },\n                    body: JSON.stringify({ toBeDeleted: newArray })\n                })\n                    .then((res) => res.text())\n                    .then((res) => {\n                        console.log(res)\n                    })\n            }, 10000)\n        }\n    }\n\n\n    render() {\n        let newArray = this.state.timeLine.map((item, index) => {\n            const uploadTime = new Date(item.time)\n            uploadTime.setMinutes(uploadTime.getMinutes() + item.time_limit_min)\n            let difference = +uploadTime - +new Date();\n            if (difference > 0) {\n                return item\n            }\n        })\n        let newerArray = newArray.filter((item) => {\n            return item\n        })\n\n\n        newerArray.sort(function (a, b) {\n            const uploadTimeA = new Date(a.time)\n            uploadTimeA.setMinutes(uploadTimeA.getMinutes() + a.time_limit_min)\n            const uploadTimeB = new Date(b.time)\n            uploadTimeB.setMinutes(uploadTimeB.getMinutes() + b.time_limit_min)\n            return uploadTimeA - uploadTimeB\n        })\n        // console.log(newerArray, `before splice`)\n        if (newerArray.length > 20) {\n            newerArray.splice(19, newerArray.length - 20)\n        }\n        // console.log(newerArray, `After splice`)\n        let merchantCard = newerArray.map((eachCard, index) => {\n            const discount = (eachCard.unit_price - eachCard.price_floor) / eachCard.unit_price * 100\n            let path = \"/\" + eachCard.merchant_id\n            return <Link to={path}>\n\n                <EachMerchant key={index} duration={eachCard.time_limit_min} listing={eachCard.listing_id} time={eachCard.time} merchant_Id={eachCard.merchant_id} what={this.testing}>\n                    <div>{index}{eachCard.name}</div>\n                    <div>up to{discount}%</div>\n                </EachMerchant>\n\n            </Link>\n        })\n\n        let deletedMerchantCard = this.state.deletedArray.map((eachCard, index) => {\n            const discount = (eachCard.unit_price - eachCard.price_floor) / eachCard.unit_price * 100\n            let path = \"/\" + eachCard.merchant_id\n            return <Link to={path}>\n\n                <>\n                    <div>{eachCard.Merchant}</div>\n                    <div>{index}{eachCard.name}</div>\n                    <div>up to{discount}%</div>\n                </>\n\n            </Link>\n        })\n\n        const routeArray = newerArray.map((eachCard, index) => {\n            let path = \"/\" + eachCard.merchant_id\n            return <Route path={path} render={\n                () => <ListingContainer merchant_id={eachCard.merchant_id} stripper={this.props.stripper} />\n            } />\n        })\n        return (\n            <div>\n                <div className=\"navbar\">\n                    <div>Image here</div>\n                    <Link className=\"login break\" to=\"/Timeline\">Timeline</Link>\n                    <Link className=\"login break\" to=\"/Orderhistory\">Order history</Link>\n                </div>\n                <main>\n                    <Switch>\n                        {routeArray}\n                        <Route path=\"/Orderhistory\" render={\n                            () => <OrderHistory />\n                        } />\n                        <Route path=\"/\" render={\n                            () => <><div>{merchantCard}</div>\n                                <div>{deletedMerchantCard}</div></>\n                        } />\n                    </Switch>\n                </main>\n            </div >\n        )\n    }\n}"]},"metadata":{},"sourceType":"module"}