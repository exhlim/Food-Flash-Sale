{"ast":null,"code":"var _jsxFileName = \"/Users/aurelialim/wdi/SEI-24-Project-3/client/src/Components/User/TimeLine/TimeLine.js\";\nimport React, { Component } from \"react\";\nimport EachMerchant from \"./EachMerchant/EachMerchant\";\nimport OrderHistory from \"../OrderHistory/OrderHistory\";\nimport { Route, Link, Redirect, Switch } from \"react-router-dom\";\nimport IndivListing from \"../IndivStore/IndivListing\";\nimport ListingContainer from \"../IndivStore/ListingContainer\";\nvar fetching = true;\nexport default class TimeLine extends Component {\n  constructor(props) {\n    super();\n\n    this.testing = prop => {\n      if (fetching === true) {\n        fetching = false;\n        setTimeout(() => {\n          console.log(`fetching new list soon`);\n          fetch(\"/timeline\").then(res => res.json()).then(res => {\n            console.log(res, `fetched`);\n            fetching = true;\n            this.setState({\n              timeLine: res,\n              fetch: !this.state.fetch\n            });\n          });\n        }, 5000);\n        setTimeout(() => {\n          console.log(`fetching deleted list soon`);\n          fetch(\"/deletedlisting\").then(res => res.json()).then(res => {\n            res.sort(function (a, b) {\n              const uploadTimeA = new Date(a.time);\n              const uploadTimeB = new Date(b.time);\n              return uploadTimeB - uploadTimeA;\n            });\n            let result = res.slice(0, 5);\n            this.setState({\n              deletedArray: result\n            });\n          });\n        }, 5000);\n        setTimeout(() => {\n          let defunctArray = this.state.timeLine.map((item, index) => {\n            const uploadTime = new Date(item.time);\n            uploadTime.setMinutes(uploadTime.getMinutes() + item.time_limit_min);\n            let difference = +uploadTime - +new Date();\n\n            if (difference < 0) {\n              return item;\n            }\n          });\n          let newArray = defunctArray.filter(item => {\n            return item;\n          });\n          console.log(`deleting soon`);\n          fetch(\"/tidyuplisting\", {\n            method: \"POST\",\n            headers: {\n              \"Content-Type\": \"application/json\"\n            },\n            body: JSON.stringify({\n              toBeDeleted: newArray\n            })\n          }).then(res => res.text()).then(res => {\n            console.log(res);\n          });\n        }, 10000);\n      }\n    };\n\n    this.state = {\n      timeLine: [],\n      deletedArray: [],\n      fetch: true\n    };\n  }\n\n  componentDidMount() {\n    fetch(\"/timeline\").then(res => res.json()).then(res => {\n      // console.log(res);\n      this.setState({\n        timeLine: res\n      });\n    });\n    fetch(\"/deletedlisting\").then(res => res.json()).then(res => {\n      console.log(res);\n\n      if (res && res.length > 0) {\n        res.sort(function (a, b) {\n          const uploadTimeA = new Date(a.time);\n          const uploadTimeB = new Date(b.time);\n          return uploadTimeB - uploadTimeA;\n        });\n        this.setState({\n          deletedArray: res\n        });\n      }\n    });\n  }\n\n  render() {\n    let newArray = this.state.timeLine.map((item, index) => {\n      const uploadTime = new Date(item.time);\n      uploadTime.setMinutes(uploadTime.getMinutes() + item.time_limit_min);\n      let difference = +uploadTime - +new Date();\n\n      if (difference > 0) {\n        return item;\n      }\n    });\n    let newerArray = newArray.filter(item => {\n      return item;\n    });\n    newerArray.sort(function (a, b) {\n      const uploadTimeA = new Date(a.time);\n      uploadTimeA.setMinutes(uploadTimeA.getMinutes() + a.time_limit_min);\n      const uploadTimeB = new Date(b.time);\n      uploadTimeB.setMinutes(uploadTimeB.getMinutes() + b.time_limit_min);\n      return uploadTimeA - uploadTimeB;\n    }); // console.log(newerArray, `before splice`)\n\n    if (newerArray.length > 20) {\n      newerArray.splice(19, newerArray.length - 20);\n    } // console.log(newerArray, `After splice`)\n\n\n    let merchantCard = newerArray.map((eachCard, index) => {\n      const discount = (eachCard.unit_price - eachCard.price_floor) / eachCard.unit_price * 100;\n      let path = \"/\" + eachCard.merchant_id;\n      return /*#__PURE__*/React.createElement(Link, {\n        to: path,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 136,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(EachMerchant, {\n        className: \"indMerc\",\n        key: index,\n        duration: eachCard.time_limit_min,\n        time: eachCard.time,\n        merchant_Id: eachCard.merchant_id,\n        what: this.testing,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 137,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 145,\n          columnNumber: 13\n        }\n      }, index, eachCard.name), /*#__PURE__*/React.createElement(\"div\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 149,\n          columnNumber: 13\n        }\n      }, \"up to\", discount, \"%\")));\n    });\n    let deletedMerchantCard = this.state.deletedArray.map((eachCard, index) => {\n      const discount = (eachCard.unit_price - eachCard.price_floor) / eachCard.unit_price * 100;\n      let path = \"/\" + eachCard.merchant_id;\n      return /*#__PURE__*/React.createElement(Link, {\n        to: path,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 161,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"div\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 163,\n          columnNumber: 13\n        }\n      }, eachCard.Merchant), /*#__PURE__*/React.createElement(\"div\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 164,\n          columnNumber: 13\n        }\n      }, index, eachCard.name), /*#__PURE__*/React.createElement(\"div\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 168,\n          columnNumber: 13\n        }\n      }, \"up to\", discount, \"%\")));\n    });\n    const routeArray = newerArray.map((eachCard, index) => {\n      let path = \"/\" + eachCard.merchant_id;\n      return /*#__PURE__*/React.createElement(Route, {\n        path: path,\n        render: () => /*#__PURE__*/React.createElement(ListingContainer, {\n          listing_id: eachCard.listing_id,\n          merchant_id: eachCard.merchant_id,\n          stripper: this.props.stripper,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 180,\n            columnNumber: 13\n          }\n        }),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 177,\n          columnNumber: 9\n        }\n      });\n    });\n    return /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 190,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"navbar\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 191,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 192,\n        columnNumber: 11\n      }\n    }, \"Image here\"), /*#__PURE__*/React.createElement(Link, {\n      className: \"login break\",\n      to: \"/Timeline\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 193,\n        columnNumber: 11\n      }\n    }, \"Timeline\"), /*#__PURE__*/React.createElement(Link, {\n      className: \"login break\",\n      to: \"/Orderhistory\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 196,\n        columnNumber: 11\n      }\n    }, \"Order history\"), /*#__PURE__*/React.createElement(\"button\", {\n      onClick: this.props.onLogout,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 199,\n        columnNumber: 11\n      }\n    }, \"Log out\")), /*#__PURE__*/React.createElement(\"main\", {\n      className: \"userMainContainer\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 201,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(Switch, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 202,\n        columnNumber: 11\n      }\n    }, routeArray, /*#__PURE__*/React.createElement(Route, {\n      path: \"/Orderhistory\",\n      render: () => /*#__PURE__*/React.createElement(OrderHistory, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 204,\n          columnNumber: 55\n        }\n      }),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 204,\n        columnNumber: 13\n      }\n    }), /*#__PURE__*/React.createElement(Route, {\n      path: \"/\",\n      render: () => /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"div\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 209,\n          columnNumber: 19\n        }\n      }, merchantCard), /*#__PURE__*/React.createElement(\"div\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 210,\n          columnNumber: 19\n        }\n      }, deletedMerchantCard)),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 205,\n        columnNumber: 13\n      }\n    }))));\n  }\n\n}","map":{"version":3,"sources":["/Users/aurelialim/wdi/SEI-24-Project-3/client/src/Components/User/TimeLine/TimeLine.js"],"names":["React","Component","EachMerchant","OrderHistory","Route","Link","Redirect","Switch","IndivListing","ListingContainer","fetching","TimeLine","constructor","props","testing","prop","setTimeout","console","log","fetch","then","res","json","setState","timeLine","state","sort","a","b","uploadTimeA","Date","time","uploadTimeB","result","slice","deletedArray","defunctArray","map","item","index","uploadTime","setMinutes","getMinutes","time_limit_min","difference","newArray","filter","method","headers","body","JSON","stringify","toBeDeleted","text","componentDidMount","length","render","newerArray","splice","merchantCard","eachCard","discount","unit_price","price_floor","path","merchant_id","name","deletedMerchantCard","Merchant","routeArray","listing_id","stripper","onLogout"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport EachMerchant from \"./EachMerchant/EachMerchant\";\nimport OrderHistory from \"../OrderHistory/OrderHistory\";\nimport { Route, Link, Redirect, Switch } from \"react-router-dom\";\nimport IndivListing from \"../IndivStore/IndivListing\";\nimport ListingContainer from \"../IndivStore/ListingContainer\";\n\nvar fetching = true;\n\nexport default class TimeLine extends Component {\n  constructor(props) {\n    super();\n    this.state = {\n      timeLine: [],\n      deletedArray: [],\n      fetch: true,\n    };\n  }\n  componentDidMount() {\n    fetch(\"/timeline\")\n      .then((res) => res.json())\n      .then((res) => {\n        // console.log(res);\n        this.setState({\n          timeLine: res,\n        });\n      });\n    fetch(\"/deletedlisting\")\n      .then((res) => res.json())\n      .then((res) => {\n        console.log(res);\n        if (res && res.length > 0) {\n          res.sort(function (a, b) {\n            const uploadTimeA = new Date(a.time);\n            const uploadTimeB = new Date(b.time);\n            return uploadTimeB - uploadTimeA;\n          });\n          this.setState({\n            deletedArray: res,\n          });\n        }\n      });\n  }\n  testing = (prop) => {\n    if (fetching === true) {\n      fetching = false;\n      setTimeout(() => {\n        console.log(`fetching new list soon`);\n        fetch(\"/timeline\")\n          .then((res) => res.json())\n          .then((res) => {\n            console.log(res, `fetched`);\n            fetching = true;\n            this.setState({\n              timeLine: res,\n              fetch: !this.state.fetch,\n            });\n          });\n      }, 5000);\n\n      setTimeout(() => {\n        console.log(`fetching deleted list soon`);\n        fetch(\"/deletedlisting\")\n          .then((res) => res.json())\n          .then((res) => {\n            res.sort(function (a, b) {\n              const uploadTimeA = new Date(a.time);\n              const uploadTimeB = new Date(b.time);\n              return uploadTimeB - uploadTimeA;\n            });\n            let result = res.slice(0, 5);\n            this.setState({\n              deletedArray: result,\n            });\n          });\n      }, 5000);\n\n      setTimeout(() => {\n        let defunctArray = this.state.timeLine.map((item, index) => {\n          const uploadTime = new Date(item.time);\n          uploadTime.setMinutes(uploadTime.getMinutes() + item.time_limit_min);\n          let difference = +uploadTime - +new Date();\n          if (difference < 0) {\n            return item;\n          }\n        });\n        let newArray = defunctArray.filter((item) => {\n          return item;\n        });\n        console.log(`deleting soon`);\n        fetch(\"/tidyuplisting\", {\n          method: \"POST\",\n          headers: {\n            \"Content-Type\": \"application/json\",\n          },\n          body: JSON.stringify({ toBeDeleted: newArray }),\n        })\n          .then((res) => res.text())\n          .then((res) => {\n            console.log(res);\n          });\n      }, 10000);\n    }\n  };\n  render() {\n    let newArray = this.state.timeLine.map((item, index) => {\n      const uploadTime = new Date(item.time);\n      uploadTime.setMinutes(uploadTime.getMinutes() + item.time_limit_min);\n      let difference = +uploadTime - +new Date();\n      if (difference > 0) {\n        return item;\n      }\n    });\n    let newerArray = newArray.filter((item) => {\n      return item;\n    });\n\n    newerArray.sort(function (a, b) {\n      const uploadTimeA = new Date(a.time);\n      uploadTimeA.setMinutes(uploadTimeA.getMinutes() + a.time_limit_min);\n      const uploadTimeB = new Date(b.time);\n      uploadTimeB.setMinutes(uploadTimeB.getMinutes() + b.time_limit_min);\n      return uploadTimeA - uploadTimeB;\n    });\n    // console.log(newerArray, `before splice`)\n    if (newerArray.length > 20) {\n      newerArray.splice(19, newerArray.length - 20);\n    }\n    // console.log(newerArray, `After splice`)\n    let merchantCard = newerArray.map((eachCard, index) => {\n      const discount =\n        ((eachCard.unit_price - eachCard.price_floor) / eachCard.unit_price) *\n        100;\n      let path = \"/\" + eachCard.merchant_id;\n      return (\n        <Link to={path}>\n          <EachMerchant\n            className=\"indMerc\"\n            key={index}\n            duration={eachCard.time_limit_min}\n            time={eachCard.time}\n            merchant_Id={eachCard.merchant_id}\n            what={this.testing}\n          >\n            <div>\n              {index}\n              {eachCard.name}\n            </div>\n            <div>up to{discount}%</div>\n          </EachMerchant>\n        </Link>\n      );\n    });\n\n    let deletedMerchantCard = this.state.deletedArray.map((eachCard, index) => {\n      const discount =\n        ((eachCard.unit_price - eachCard.price_floor) / eachCard.unit_price) *\n        100;\n      let path = \"/\" + eachCard.merchant_id;\n      return (\n        <Link to={path}>\n          <>\n            <div>{eachCard.Merchant}</div>\n            <div>\n              {index}\n              {eachCard.name}\n            </div>\n            <div>up to{discount}%</div>\n          </>\n        </Link>\n      );\n    });\n\n    const routeArray = newerArray.map((eachCard, index) => {\n      let path = \"/\" + eachCard.merchant_id;\n      return (\n        <Route\n          path={path}\n          render={() => (\n            <ListingContainer\n              listing_id={eachCard.listing_id}\n              merchant_id={eachCard.merchant_id}\n              stripper={this.props.stripper}\n            />\n          )}\n        />\n      );\n    });\n    return (\n      <div>\n        <div className=\"navbar\">\n          <div>Image here</div>\n          <Link className=\"login break\" to=\"/Timeline\">\n            Timeline\n          </Link>\n          <Link className=\"login break\" to=\"/Orderhistory\">\n            Order history\n          </Link>\n          <button onClick={this.props.onLogout}>Log out</button>\n        </div>\n        <main className=\"userMainContainer\">\n          <Switch>\n            {routeArray}\n            <Route path=\"/Orderhistory\" render={() => <OrderHistory />} />\n            <Route\n              path=\"/\"\n              render={() => (\n                <>\n                  <div>{merchantCard}</div>\n                  <div>{deletedMerchantCard}</div>\n                </>\n              )}\n            />\n          </Switch>\n        </main>\n      </div>\n    );\n  }\n}\n"]},"metadata":{},"sourceType":"module"}