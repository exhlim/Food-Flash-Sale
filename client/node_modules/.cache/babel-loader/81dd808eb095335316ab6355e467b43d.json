{"ast":null,"code":"var _jsxFileName = \"/home/rlyz/wdi/sei-24-project-3/client/src/Components/User/IndivStore/ListingContainer.js\";\nimport React from 'react';\nimport IndivListing from './IndivListing';\nimport Basket from './Basket';\nimport PaymentOverlay from './PaymentOverlay';\nimport { Elements, CardElement, useStripe, useElements } from '@stripe/react-stripe-js';\nimport { loadStripe } from '@stripe/stripe-js';\n\nconst CheckoutForm = props => {\n  const stripe = useStripe();\n  const elements = useElements();\n\n  const handleSubmit = async event => {\n    // Block native form submission.\n    event.preventDefault();\n\n    if (!stripe || !elements) {\n      // Stripe.js has not loaded yet. Make sure to disable\n      // form submission until Stripe.js has loaded.\n      return;\n    } // Get a reference to a mounted CardElement. Elements knows how\n    // to find your CardElement because there can only ever be one of\n    // each type of element.\n\n\n    const cardElement = elements.getElement(CardElement); // Use your card Element with other Stripe.js APIs\n\n    const {\n      error,\n      paymentMethod\n    } = await stripe.createPaymentMethod({\n      type: 'card',\n      card: cardElement\n    });\n\n    if (error) {\n      console.log('[error]', error);\n    } else {\n      console.log('[PaymentMethod]', paymentMethod);\n      fetch('/submitOrder', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          card: paymentMethod,\n          order: props.data\n        })\n      }).then(res => res.json()).then(res => {\n        // console.log(res)\n        this.setState({\n          details: res,\n          fetch: true\n        });\n      });\n    }\n  };\n\n  return /*#__PURE__*/React.createElement(\"form\", {\n    style: {\n      maxWidth: \"500px\",\n      margin: \"0 auto\"\n    },\n    onSubmit: handleSubmit,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 59,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(CardElement, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 60,\n      columnNumber: 13\n    }\n  }), /*#__PURE__*/React.createElement(\"button\", {\n    type: \"submit\",\n    disabled: !stripe,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 61,\n      columnNumber: 13\n    }\n  }, \"Pay\"));\n};\n\nexport default class ListingContainer extends React.Component {\n  constructor(props) {\n    //mounting\n    super(props);\n    console.log(\"----inside Listing constructor\");\n    this.state = {\n      merchant_id: props.merchant_id,\n      merchant_name: \"\",\n      merchant_img: \"\",\n      html: [],\n      result: [],\n      cart: [],\n      viewCart: false,\n      checkout: false\n    };\n    this.addToCart = this.addToCart.bind(this);\n    this.navigateTo = this.navigateTo.bind(this);\n    this.handleAddToCart = this.handleAddToCart.bind(this);\n    this.handleRemoveFromCart = this.handleRemoveFromCart.bind(this);\n    this.handleCheckOut = this.handleCheckOut.bind(this);\n  } //\n  //payment click handlling\n\n\n  handleCheckOut() {\n    this.setState({\n      checkout: true\n    });\n  } //delete from cart\n\n\n  handleRemoveFromCart(e, item) {\n    this.setState(state => {\n      const cart = state.cart.filter(element => element.name != item.name);\n      localStorage.setItem('cart', cart);\n      return {\n        cart\n      };\n    });\n  } //add to cart button\n\n\n  addToCart(e, addToCart) {\n    console.log(addToCart);\n    this.setState(prevState => ({\n      cart: [...prevState.cart, addToCart]\n    }));\n  } // view cart button\n\n\n  navigateTo() {\n    this.setState({\n      viewCart: !this.state.viewCart\n    });\n  }\n\n  handleAddToCart(e, product) {\n    console.log(product);\n    this.setState(state => {\n      const cart = state.cart;\n      let productAlreadyInCart = false;\n      cart.forEach(item => {\n        if (item.name === product.name) {\n          productAlreadyInCart = true;\n          item.count++;\n        }\n      });\n\n      if (!productAlreadyInCart) {\n        cart.push({ ...product,\n          count: 1\n        });\n      }\n\n      localStorage.setItem(\"cart\", JSON.stringify(cart));\n      return cart;\n      console.log(this.state.cart);\n    });\n  } //when state is changed, FETCH results from aPI\n  //side effects ie: HTTP requests are allowed here\n\n\n  componentDidMount() {\n    fetch(\"/indivshop/1\").then(res => res.json()).then(res => this.setState({\n      result: res,\n      html: this.format(res),\n      merchant_name: res[0].name\n    }));\n  } //update and re-render once checkout is clicked and this.state.checkout=true;\n\n\n  componentDidUpdate(prevProps, prevState) {\n    if (prevState.checkout !== this.state.checkout) {\n      return /*#__PURE__*/React.createElement(PaymentOverlay, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 167,\n          columnNumber: 20\n        }\n      });\n    }\n  } //helper functions\n  //take the res.json and convert into nice HTML\n\n\n  format(array) {\n    return array.map((item, index) => {\n      let item_name = item.item_name;\n      let quantity = item.quantity;\n      let discPrice = item.price_ceiling;\n      let originalPrice = item.unit_price;\n      let discount = (originalPrice - discPrice) / originalPrice;\n      let merchant_name = item.name;\n      let cuisine = item.cuisine;\n      let listing_id = item.listing_id;\n      let merchant_id = item.merchant_id;\n      return /*#__PURE__*/React.createElement(\"div\", {\n        key: index,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 188,\n          columnNumber: 20\n        }\n      }, /*#__PURE__*/React.createElement(IndivListing, {\n        item_name: item_name,\n        quantity: quantity,\n        discPrice: discPrice,\n        originalPrice: originalPrice,\n        discPrice: discPrice,\n        discount: discount,\n        merchant_name: merchant_name,\n        cuisine: cuisine,\n        onClick: this.handleAddToCart,\n        listing_id: listing_id,\n        merchant_id: merchant_id,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 189,\n          columnNumber: 17\n        }\n      }));\n    });\n  }\n\n  render() {\n    const stripePromise = loadStripe(this.props.stripper); // if (this.state.checkout) {\n    //     return (\n    //         <div><PaymentOverlay cart={this.state.cart} stripper={this.props.stripper} /></div>\n    //     )\n    // }\n\n    if (this.state.viewCart && this.state.cart[0]) {\n      let data = {\n        merchant_id: this.state.cart[0].merchant_id,\n        user_id: this.state.cart[0].user_id,\n        listing_id: this.state.cart[0].listing_id,\n        price: this.state.cart[0].price,\n        quantity: this.state.cart[0].count / 2,\n        revenue: this.state.cart[0].count / 2 * this.state.cart[0].price\n      };\n      return /*#__PURE__*/React.createElement(\"div\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 218,\n          columnNumber: 17\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 220,\n          columnNumber: 21\n        }\n      }, /*#__PURE__*/React.createElement(\"h1\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 221,\n          columnNumber: 25\n        }\n      }, \"You are viewing deals from \", this.state.merchant_name), /*#__PURE__*/React.createElement(\"br\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 222,\n          columnNumber: 25\n        }\n      }), /*#__PURE__*/React.createElement(\"h1\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 223,\n          columnNumber: 25\n        }\n      }, \"Order Summary\"), /*#__PURE__*/React.createElement(\"table\", {\n        style: {\n          maxWidth: \"300px\",\n          margin: \"0 auto\"\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 224,\n          columnNumber: 25\n        }\n      }, /*#__PURE__*/React.createElement(\"tr\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 225,\n          columnNumber: 29\n        }\n      }, /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 226,\n          columnNumber: 33\n        }\n      }, \"Item Name\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 227,\n          columnNumber: 33\n        }\n      }, \"Quantity\"), /*#__PURE__*/React.createElement(\"th\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 228,\n          columnNumber: 33\n        }\n      }, \"Total\")), /*#__PURE__*/React.createElement(\"tr\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 230,\n          columnNumber: 29\n        }\n      }, /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 231,\n          columnNumber: 33\n        }\n      }, this.state.cart[0].name), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 232,\n          columnNumber: 33\n        }\n      }, this.state.cart[0].count / 2), /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 233,\n          columnNumber: 33\n        }\n      }, \"Total: $\", this.state.cart[0].count / 2 * this.state.cart[0].price))), /*#__PURE__*/React.createElement(Elements, {\n        stripe: stripePromise,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 246,\n          columnNumber: 25\n        }\n      }, /*#__PURE__*/React.createElement(CheckoutForm, {\n        data: data,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 246,\n          columnNumber: 58\n        }\n      }))), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"ListItems\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 250,\n          columnNumber: 21\n        }\n      }, this.state.html));\n    } else {\n      return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"button\", {\n        onClick: this.navigateTo,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 259,\n          columnNumber: 21\n        }\n      }, \"View Cart \", this.state.cart.length), /*#__PURE__*/React.createElement(\"h1\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 260,\n          columnNumber: 21\n        }\n      }, \"You are viewing deals from \", this.state.merchant_name), /*#__PURE__*/React.createElement(\"br\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 261,\n          columnNumber: 21\n        }\n      }), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"ListItems\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 263,\n          columnNumber: 21\n        }\n      }, this.state.html));\n    }\n  }\n\n}","map":{"version":3,"sources":["/home/rlyz/wdi/sei-24-project-3/client/src/Components/User/IndivStore/ListingContainer.js"],"names":["React","IndivListing","Basket","PaymentOverlay","Elements","CardElement","useStripe","useElements","loadStripe","CheckoutForm","props","stripe","elements","handleSubmit","event","preventDefault","cardElement","getElement","error","paymentMethod","createPaymentMethod","type","card","console","log","fetch","method","headers","body","JSON","stringify","order","data","then","res","json","setState","details","maxWidth","margin","ListingContainer","Component","constructor","state","merchant_id","merchant_name","merchant_img","html","result","cart","viewCart","checkout","addToCart","bind","navigateTo","handleAddToCart","handleRemoveFromCart","handleCheckOut","e","item","filter","element","name","localStorage","setItem","prevState","product","productAlreadyInCart","forEach","count","push","componentDidMount","format","componentDidUpdate","prevProps","array","map","index","item_name","quantity","discPrice","price_ceiling","originalPrice","unit_price","discount","cuisine","listing_id","render","stripePromise","stripper","user_id","price","revenue","length"],"mappings":"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","sourcesContent":["import React from 'react';\nimport IndivListing from './IndivListing';\nimport Basket from './Basket';\nimport PaymentOverlay from './PaymentOverlay';\nimport { Elements, CardElement, useStripe, useElements } from '@stripe/react-stripe-js';\nimport { loadStripe } from '@stripe/stripe-js'\n\nconst CheckoutForm = (props) => {\n    const stripe = useStripe();\n    const elements = useElements();\n\n    const handleSubmit = async (event) => {\n        // Block native form submission.\n        event.preventDefault();\n\n        if (!stripe || !elements) {\n            // Stripe.js has not loaded yet. Make sure to disable\n            // form submission until Stripe.js has loaded.\n            return;\n        }\n\n        // Get a reference to a mounted CardElement. Elements knows how\n        // to find your CardElement because there can only ever be one of\n        // each type of element.\n        const cardElement = elements.getElement(CardElement);\n\n        // Use your card Element with other Stripe.js APIs\n        const { error, paymentMethod } = await stripe.createPaymentMethod({\n            type: 'card',\n            card: cardElement,\n        });\n\n        if (error) {\n            console.log('[error]', error);\n        } else {\n            console.log('[PaymentMethod]', paymentMethod);\n            fetch('/submitOrder', {\n                method: 'POST',\n                headers: {\n                    'Content-Type': 'application/json'\n                },\n                body: JSON.stringify({\n                    card: paymentMethod,\n                    order: props.data\n                })\n            })\n                .then((res) => res.json())\n                .then((res) => {\n                    // console.log(res)\n                    this.setState({\n                        details: res,\n                        fetch: true\n                    })\n                })\n        }\n    };\n\n    return (\n        <form style={{ maxWidth: \"500px\", margin: \"0 auto\" }} onSubmit={handleSubmit}>\n            <CardElement />\n            <button type=\"submit\" disabled={!stripe}>\n                Pay\n        </button>\n        </form>\n    );\n};\n\nexport default class ListingContainer extends React.Component {\n    constructor(props) {\n        //mounting\n        super(props)\n        console.log(\"----inside Listing constructor\")\n\n        this.state = {\n            merchant_id: props.merchant_id,\n            merchant_name: \"\",\n            merchant_img: \"\",\n            html: [],\n            result: [],\n            cart: [],\n            viewCart: false,\n            checkout: false\n        }\n\n        this.addToCart = this.addToCart.bind(this);\n        this.navigateTo = this.navigateTo.bind(this)\n        this.handleAddToCart = this.handleAddToCart.bind(this)\n        this.handleRemoveFromCart = this.handleRemoveFromCart.bind(this);\n        this.handleCheckOut = this.handleCheckOut.bind(this)\n\n    }\n    //\n\n\n\n\n    //payment click handlling\n    handleCheckOut() {\n        this.setState({ checkout: true })\n\n    }\n\n\n\n\n    //delete from cart\n    handleRemoveFromCart(e, item) {\n        this.setState(state => {\n            const cart = state.cart.filter(element => element.name != item.name);\n            localStorage.setItem('cart', cart);\n            return { cart }\n        })\n    }\n\n\n    //add to cart button\n    addToCart(e, addToCart) {\n        console.log(addToCart)\n        this.setState((prevState) =>\n            ({ cart: [...prevState.cart, addToCart] }))\n    }\n\n\n    // view cart button\n    navigateTo() {\n        this.setState({ viewCart: !this.state.viewCart })\n    }\n\n    handleAddToCart(e, product) {\n        console.log(product)\n\n        this.setState(state => {\n            const cart = state.cart;\n            let productAlreadyInCart = false;\n            cart.forEach(item => {\n                if (item.name === product.name) {\n                    productAlreadyInCart = true;\n                    item.count++;\n                }\n            });\n            if (!productAlreadyInCart) {\n                cart.push({ ...product, count: 1 })\n            }\n            localStorage.setItem(\"cart\", JSON.stringify(cart));\n            return cart;\n            console.log(this.state.cart)\n        })\n    }\n\n\n\n    //when state is changed, FETCH results from aPI\n    //side effects ie: HTTP requests are allowed here\n    componentDidMount() {\n        fetch(\"/indivshop/1\")\n            .then(res => res.json())\n            .then(res =>\n                this.setState({ result: res, html: this.format(res), merchant_name: res[0].name })\n            )\n    }\n\n\n    //update and re-render once checkout is clicked and this.state.checkout=true;\n\n    componentDidUpdate(prevProps, prevState) {\n        if (prevState.checkout !== this.state.checkout) {\n            return <PaymentOverlay />\n        }\n    }\n\n\n\n    //helper functions\n\n    //take the res.json and convert into nice HTML\n    format(array) {\n        return array.map((item, index) => {\n            let item_name = item.item_name;\n            let quantity = item.quantity;\n            let discPrice = item.price_ceiling;\n            let originalPrice = item.unit_price;\n            let discount = (originalPrice - discPrice) / originalPrice\n            let merchant_name = item.name;\n            let cuisine = item.cuisine;\n            let listing_id = item.listing_id;\n            let merchant_id = item.merchant_id\n\n            return <div key={index}>\n                <IndivListing item_name={item_name} quantity={quantity} discPrice={discPrice} originalPrice={originalPrice} discPrice={discPrice} discount={discount} merchant_name={merchant_name} cuisine={cuisine} onClick={this.handleAddToCart} listing_id={listing_id} merchant_id={merchant_id} />\n\n            </div>\n        })\n    }\n\n\n    render() {\n        const stripePromise = loadStripe(this.props.stripper)\n        // if (this.state.checkout) {\n        //     return (\n        //         <div><PaymentOverlay cart={this.state.cart} stripper={this.props.stripper} /></div>\n\n        //     )\n        // }\n\n\n\n\n        if (this.state.viewCart && this.state.cart[0]) {\n            let data = {\n                merchant_id: this.state.cart[0].merchant_id,\n                user_id: this.state.cart[0].user_id,\n                listing_id: this.state.cart[0].listing_id,\n                price: this.state.cart[0].price,\n                quantity: this.state.cart[0].count / 2,\n                revenue: this.state.cart[0].count / 2 * this.state.cart[0].price\n            }\n            return (\n                <div>\n\n                    <div>\n                        <h1>You are viewing deals from {this.state.merchant_name}</h1>\n                        <br />\n                        <h1>Order Summary</h1>\n                        <table style={{ maxWidth: \"300px\", margin: \"0 auto\" }}>\n                            <tr>\n                                <th>Item Name</th>\n                                <th>Quantity</th>\n                                <th>Total</th>\n                            </tr>\n                            <tr>\n                                <td>{this.state.cart[0].name}</td>\n                                <td>{this.state.cart[0].count / 2}</td>\n                                <td>Total: ${this.state.cart[0].count / 2 * this.state.cart[0].price}</td>\n                            </tr>\n                        </table>\n\n                        {/* <form style={{ maxWidth: \"300px\", margin: \"0 auto\" }}  > */}\n                        {/* action=\"/submitOrder\" */}\n\n                        {/* <input type=\"hidden\" value={this.state.cart[0].merchant_id} name=\"merchant_id\" />\n                            <input type=\"hidden\" value={this.state.cart[0].user_id} name=\"user_id\" />\n                            <input type=\"hidden\" value={this.state.cart[0].price} name=\"price\" />\n                            <input type=\"hidden\" value={this.state.cart[0].listing_id} name=\"listing_id\" />\n                            <input type=\"hidden\" value={this.state.cart[0].count / 2} name=\"quantity\" />\n                            <input type=\"hidden\" value={this.state.cart[0].count / 2 * this.state.cart[0].price} name=\"revenue\" /> */}\n                        <Elements stripe={stripePromise}><CheckoutForm data={data}></CheckoutForm></Elements>\n                        {/* <input type=\"button\" value=\"Checkout\" onClick={(e) => { this.submitHandler(e) }} />*/}\n                        {/* </form> */}\n                    </div>\n                    <div className=\"ListItems\" >\n                        {this.state.html}\n                    </div>\n                </div>\n            )\n\n        } else {\n            return (\n                <>\n                    <button onClick={this.navigateTo}>View Cart {this.state.cart.length}</button>\n                    <h1>You are viewing deals from {this.state.merchant_name}</h1>\n                    <br />\n\n                    <div className=\"ListItems\" >\n                        {this.state.html}\n                    </div>\n\n                </>\n            )\n        }\n    }\n}"]},"metadata":{},"sourceType":"module"}