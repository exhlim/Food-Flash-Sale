{"ast":null,"code":"var _jsxFileName = \"/Users/aurelialim/wdi/SEI-24-Project-3/client/src/Components/User/TimeLine/TimeLine.js\";\nimport React, { Component } from \"react\";\nimport EachMerchant from \"./EachMerchant/EachMerchant\";\nimport OrderHistory from \"../OrderHistory/OrderHistory\";\nimport { Route, Link, Redirect, Switch } from \"react-router-dom\";\nimport IndivListing from \"../IndivStore/IndivListing\";\nimport ListingContainer from \"../IndivStore/ListingContainer\";\nimport ByCategory from \"./housekeeping switch\";\nimport ByDiscount from \"./ByDiscount\";\nimport ByDistance from \"./ByDistance\";\nvar fetching = true;\nvar newArray = [];\nexport default class TimeLine extends Component {\n  constructor(props) {\n    super(props);\n\n    this.testing = prop => {\n      if (fetching === true) {\n        fetching = false;\n        setTimeout(() => {\n          console.log(`fetching new list soon`);\n          fetch(\"/timeline\").then(res => res.json()).then(res => {\n            console.log(res, `fetched`);\n            fetching = true;\n            this.setState({\n              timeLine: res\n            });\n          });\n        }, 5000);\n        setTimeout(() => {\n          console.log(`fetching deleted list soon`);\n          fetch(\"/deletedlisting\").then(res => res.json()).then(res => {\n            if (res && res.length > 0) {\n              res.sort(function (a, b) {\n                const uploadTimeA = new Date(a.time);\n                const uploadTimeB = new Date(b.time);\n                return uploadTimeB - uploadTimeA;\n              });\n              this.setState({\n                deletedArray: res\n              });\n            }\n          });\n        }, 5000);\n        setTimeout(() => {\n          let defunctArray = this.state.timeLine.map((item, index) => {\n            const uploadTime = new Date(item.time);\n            uploadTime.setMinutes(uploadTime.getMinutes() + item.time_limit_min);\n            let difference = +uploadTime - +new Date();\n\n            if (difference < 0) {\n              return item;\n            }\n          });\n          let newArray = defunctArray.filter(item => {\n            return item;\n          });\n          console.log(`deleting soon`);\n          fetch(\"/tidyuplisting\", {\n            method: \"POST\",\n            headers: {\n              \"Content-Type\": \"application/json\"\n            },\n            body: JSON.stringify({\n              toBeDeleted: newArray\n            })\n          }).then(res => res.text()).then(res => {\n            console.log(res);\n          });\n        }, 10000);\n      }\n    };\n\n    this.state = {\n      timeLine: [],\n      deletedArray: [],\n      filter: \"\",\n      sorted: [],\n      lat: props.lat,\n      lon: props.lon,\n      status: \"True\",\n      mode: \"default\"\n    };\n  }\n\n  componentDidMount() {\n    fetch(\"/timeline\").then(res => res.json()).then(res => {\n      // console.log(res);\n      this.setState({\n        timeLine: res\n      });\n    });\n    fetch(\"/deletedlisting\").then(res => res.json()).then(res => {\n      console.log(res);\n\n      if (res && res.length > 0) {\n        res.sort(function (a, b) {\n          const uploadTimeA = new Date(a.time);\n          const uploadTimeB = new Date(b.time);\n          return uploadTimeB - uploadTimeA;\n        });\n        this.setState({\n          deletedArray: res\n        });\n      }\n    });\n  }\n\n  render() {\n    let Array = this.state.timeLine.map((item, index) => {\n      const uploadTime = new Date(item.time);\n      uploadTime.setMinutes(uploadTime.getMinutes() + item.time_limit_min);\n      let difference = +uploadTime - +new Date();\n\n      if (difference > 0) {\n        return item;\n      }\n    });\n    let nArray = Array.filter(item => {\n      return item;\n    });\n    nArray.sort(function (a, b) {\n      const uploadTimeA = new Date(a.time);\n      uploadTimeA.setMinutes(uploadTimeA.getMinutes() + a.time_limit_min);\n      const uploadTimeB = new Date(b.time);\n      uploadTimeB.setMinutes(uploadTimeB.getMinutes() + b.time_limit_min);\n      return uploadTimeA - uploadTimeB;\n    }); // console.log(newerArray, `before splice`)\n\n    if (nArray.length > 20) {\n      nArray.splice(19, nArray.length - 20);\n    }\n\n    let merchantCard = nArray.map((eachCard, index) => {\n      const discount = (eachCard.unit_price - eachCard.price_floor) / eachCard.unit_price * 100;\n      let path = \"/\" + eachCard.merchant_id;\n      return /*#__PURE__*/React.createElement(Link, {\n        class: \"col-lg-4 col-md-6 mb-4\",\n        to: path,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 145,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(EachMerchant, {\n        className: \"card h-100\",\n        key: index,\n        duration: eachCard.time_limit_min,\n        time: eachCard.time,\n        merchant_Id: eachCard.merchant_id,\n        what: this.testing,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 146,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"img\", {\n        class: \"card-img-top\",\n        src: \"https://picsum.photos/700/400\",\n        alt: \"\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 154,\n          columnNumber: 13\n        }\n      }), /*#__PURE__*/React.createElement(\"h4\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 159,\n          columnNumber: 13\n        }\n      }, eachCard.name, \" \", discount, \"%\"), /*#__PURE__*/React.createElement(\"p\", {\n        class: \"card-text\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 162,\n          columnNumber: 13\n        }\n      }, \"Lorem ipsum dolor sit amet\")));\n    }); // console.log(newerArray, `After splice`)\n\n    let deletedMerchantCard = this.state.deletedArray.map((eachCard, index) => {\n      const discount = (eachCard.unit_price - eachCard.price_floor) / eachCard.unit_price * 100;\n      let path = \"/\" + eachCard.merchant_id;\n      return /*#__PURE__*/React.createElement(Link, {\n        class: \"col-lg-4 col-md-6 mb-4\",\n        to: path,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 174,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"card h-100\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 175,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"img\", {\n        class: \"card-img-top\",\n        src: \"https://picsum.photos/700/400\",\n        alt: \"\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 176,\n          columnNumber: 13\n        }\n      }), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"card-body\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 181,\n          columnNumber: 13\n        }\n      }, /*#__PURE__*/React.createElement(\"h4\", {\n        class: \"card-title\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 182,\n          columnNumber: 15\n        }\n      }, eachCard.Merchant), /*#__PURE__*/React.createElement(\"div\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 183,\n          columnNumber: 15\n        }\n      }, eachCard.name), /*#__PURE__*/React.createElement(\"div\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 184,\n          columnNumber: 15\n        }\n      }, \"up to\", discount, \"%\"))));\n    });\n    const routeArray = nArray.map((eachCard, index) => {\n      let path = \"/\" + eachCard.merchant_id;\n      return /*#__PURE__*/React.createElement(Route, {\n        path: path,\n        render: () => /*#__PURE__*/React.createElement(ListingContainer, {\n          listing_id: eachCard.listing_id,\n          merchant_id: eachCard.merchant_id,\n          stripper: this.props.stripper,\n          user_id: this.props.user_id,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 196,\n            columnNumber: 13\n          }\n        }),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 193,\n          columnNumber: 9\n        }\n      });\n    });\n    return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"nav\", {\n      class: \"navbar navbar-expand-lg navbar-dark bg-dark fixed-top\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 208,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      class: \"container\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 209,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"a\", {\n      class: \"navbar-brand\",\n      href: \"#\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 210,\n        columnNumber: 13\n      }\n    }, \"Start Bootstrap\"), /*#__PURE__*/React.createElement(\"button\", {\n      class: \"navbar-toggler\",\n      type: \"button\",\n      \"data-toggle\": \"collapse\",\n      \"data-target\": \"#navbarResponsive\",\n      \"aria-controls\": \"navbarResponsive\",\n      \"aria-expanded\": \"false\",\n      \"aria-label\": \"Toggle navigation\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 213,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"span\", {\n      class: \"navbar-toggler-icon\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 222,\n        columnNumber: 15\n      }\n    })), /*#__PURE__*/React.createElement(\"div\", {\n      class: \"collapse navbar-collapse\",\n      id: \"navbarResponsive\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 224,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"ul\", {\n      class: \"navbar-nav ml-auto\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 225,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(\"li\", {\n      class: \"nav-item active\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 226,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(Link, {\n      to: \"/Timeline\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 227,\n        columnNumber: 19\n      }\n    }, \"Timeline\", /*#__PURE__*/React.createElement(\"span\", {\n      class: \"sr-only\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 228,\n        columnNumber: 29\n      }\n    }, \"(current)\"))), /*#__PURE__*/React.createElement(\"li\", {\n      class: \"nav-item\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 231,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(Link, {\n      to: \"/Orderhistory\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 232,\n        columnNumber: 19\n      }\n    }, \"Order history\")), /*#__PURE__*/React.createElement(\"li\", {\n      class: \"nav-item\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 234,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(Link, {\n      to: \"/ByDistance\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 235,\n        columnNumber: 19\n      }\n    }, \"Distance\")), /*#__PURE__*/React.createElement(\"li\", {\n      class: \"nav-item\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 237,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(Link, {\n      to: \"/ByDiscount\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 238,\n        columnNumber: 19\n      }\n    }, \"Discount\"))), /*#__PURE__*/React.createElement(\"button\", {\n      onClick: this.props.onLogout,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 241,\n        columnNumber: 15\n      }\n    }, \"Log out\")))), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"container\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 245,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      id: \"carouselExampleIndicators\",\n      class: \"carousel slide my-4\",\n      \"data-ride\": \"carousel\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 246,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"ol\", {\n      class: \"carousel-indicators\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 251,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"li\", {\n      \"data-target\": \"#carouselExampleIndicators\",\n      \"data-slide-to\": \"0\",\n      class: \"active\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 252,\n        columnNumber: 15\n      }\n    }), /*#__PURE__*/React.createElement(\"li\", {\n      \"data-target\": \"#carouselExampleIndicators\",\n      \"data-slide-to\": \"1\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 257,\n        columnNumber: 15\n      }\n    }), /*#__PURE__*/React.createElement(\"li\", {\n      \"data-target\": \"#carouselExampleIndicators\",\n      \"data-slide-to\": \"2\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 261,\n        columnNumber: 15\n      }\n    })), /*#__PURE__*/React.createElement(\"div\", {\n      class: \"carousel-inner\",\n      role: \"listbox\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 266,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      class: \"carousel-item active\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 267,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(\"img\", {\n      class: \"d-block img-fluid\",\n      src: \"https://picsum.photos/1110/350\",\n      alt: \"First slide\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 268,\n        columnNumber: 17\n      }\n    })), /*#__PURE__*/React.createElement(\"div\", {\n      class: \"carousel-item\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 274,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(\"img\", {\n      class: \"d-block img-fluid\",\n      src: \"https://picsum.photos/1110/350\",\n      alt: \"Second slide\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 275,\n        columnNumber: 17\n      }\n    })), /*#__PURE__*/React.createElement(\"div\", {\n      class: \"carousel-item\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 281,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(\"img\", {\n      class: \"d-block img-fluid\",\n      src: \"https://picsum.photos/1110/350\",\n      alt: \"Third slide\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 282,\n        columnNumber: 17\n      }\n    })))), /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 290,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"select\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 291,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"option\", {\n      value: \"Time\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 292,\n        columnNumber: 15\n      }\n    }, \"Time Left\"), /*#__PURE__*/React.createElement(\"option\", {\n      value: \"Discount\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 293,\n        columnNumber: 15\n      }\n    }, \"Discount\"), /*#__PURE__*/React.createElement(\"option\", {\n      value: \"Distance\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 294,\n        columnNumber: 15\n      }\n    }, \"Distance\"))), /*#__PURE__*/React.createElement(\"main\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 297,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(Switch, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 298,\n        columnNumber: 13\n      }\n    }, routeArray, /*#__PURE__*/React.createElement(Route, {\n      path: \"/Orderhistory\",\n      render: () => /*#__PURE__*/React.createElement(OrderHistory, {\n        user_id: this.props.user_id,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 302,\n          columnNumber: 31\n        }\n      }),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 300,\n        columnNumber: 15\n      }\n    }), /*#__PURE__*/React.createElement(Route, {\n      path: \"/ByDistance\",\n      render: () => /*#__PURE__*/React.createElement(ByDistance, {\n        lon: this.props.lon,\n        lat: this.props.lat,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 310,\n          columnNumber: 19\n        }\n      }),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 307,\n        columnNumber: 15\n      }\n    }), /*#__PURE__*/React.createElement(Route, {\n      path: \"/ByDiscount\",\n      render: () => /*#__PURE__*/React.createElement(ByDiscount, {\n        lon: this.props.lon,\n        lat: this.props.lat,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 316,\n          columnNumber: 19\n        }\n      }),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 313,\n        columnNumber: 15\n      }\n    }), /*#__PURE__*/React.createElement(Route, {\n      path: \"/\",\n      render: () => /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"h1\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 323,\n          columnNumber: 21\n        }\n      }, \"Ongoing Deals\"), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"row\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 324,\n          columnNumber: 21\n        }\n      }, this.state.status ? merchantCard : /*#__PURE__*/React.createElement(\"div\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 325,\n          columnNumber: 59\n        }\n      }, \"sortedCard\")), /*#__PURE__*/React.createElement(\"h1\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 327,\n          columnNumber: 21\n        }\n      }, \"Expired Deals\"), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"row\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 328,\n          columnNumber: 21\n        }\n      }, deletedMerchantCard)),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 319,\n        columnNumber: 15\n      }\n    })))));\n  }\n\n} //\n// First Option\n// 1) Starting Price is our price ceiling\n// 2) When timeleft = time left / 2\n// 3) price will be price ceiling + price floor /2\n// 4) taking time left split into 4 Segements\n//\n// segement1\n//   price ceiling -  80/100 * price difference = 6.54\n// segment2\n//   price ceiling - 60/100 * price difference = 6.28\n// segment3\n//   price ceiling - 40/100 * price difference = 6.02\n// segment4\n// if 10% or>\n//     price ceiling - 20/100 * price difference =5.76\n//     else\n//     price floor\n//     else (based on time set to price floor)\n// up 7\n// price ceiling 6.80\n// price floor   5.50         price difference 1.30 0-100%\n// price c\n// hard code average time on item creation into the database\n//\n//                                                       qty is static in our DB, possibly carry out second fetch on orders to sum qty to     ////////////                                                       calcualte OR write into DB a new column to keep adding to check sale\n// average time taken to sell an item  get current time - upload time = price difference divide by uploaded qty - remaining qty  ( ) <---------------------how?\n// compare it to the \"estimated time\" to sell 1hr 10\n//\n// if more/ less\n// metric duration = time taken to sell out / tiem set by the user\n// 10 items 0:00\n// 9items   0:06\n// 8         0:12<-------  average time setimt time_limit_min /items\n//\n//\n// 1 hour\n//","map":{"version":3,"sources":["/Users/aurelialim/wdi/SEI-24-Project-3/client/src/Components/User/TimeLine/TimeLine.js"],"names":["React","Component","EachMerchant","OrderHistory","Route","Link","Redirect","Switch","IndivListing","ListingContainer","ByCategory","ByDiscount","ByDistance","fetching","newArray","TimeLine","constructor","props","testing","prop","setTimeout","console","log","fetch","then","res","json","setState","timeLine","length","sort","a","b","uploadTimeA","Date","time","uploadTimeB","deletedArray","defunctArray","state","map","item","index","uploadTime","setMinutes","getMinutes","time_limit_min","difference","filter","method","headers","body","JSON","stringify","toBeDeleted","text","sorted","lat","lon","status","mode","componentDidMount","render","Array","nArray","splice","merchantCard","eachCard","discount","unit_price","price_floor","path","merchant_id","name","deletedMerchantCard","Merchant","routeArray","listing_id","stripper","user_id","onLogout"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport EachMerchant from \"./EachMerchant/EachMerchant\";\nimport OrderHistory from \"../OrderHistory/OrderHistory\";\nimport { Route, Link, Redirect, Switch } from \"react-router-dom\";\nimport IndivListing from \"../IndivStore/IndivListing\";\nimport ListingContainer from \"../IndivStore/ListingContainer\";\nimport ByCategory from \"./housekeeping switch\";\nimport ByDiscount from \"./ByDiscount\";\nimport ByDistance from \"./ByDistance\";\nvar fetching = true;\nvar newArray = [];\n\nexport default class TimeLine extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      timeLine: [],\n      deletedArray: [],\n      filter: \"\",\n      sorted: [],\n      lat: props.lat,\n      lon: props.lon,\n      status: \"True\",\n      mode: \"default\",\n    };\n  }\n  componentDidMount() {\n    fetch(\"/timeline\")\n      .then((res) => res.json())\n      .then((res) => {\n        // console.log(res);\n        this.setState({\n          timeLine: res,\n        });\n      });\n\n    fetch(\"/deletedlisting\")\n      .then((res) => res.json())\n      .then((res) => {\n        console.log(res);\n        if (res && res.length > 0) {\n          res.sort(function (a, b) {\n            const uploadTimeA = new Date(a.time);\n            const uploadTimeB = new Date(b.time);\n            return uploadTimeB - uploadTimeA;\n          });\n          this.setState({\n            deletedArray: res,\n          });\n        }\n      });\n  }\n\n  testing = (prop) => {\n    if (fetching === true) {\n      fetching = false;\n      setTimeout(() => {\n        console.log(`fetching new list soon`);\n        fetch(\"/timeline\")\n          .then((res) => res.json())\n          .then((res) => {\n            console.log(res, `fetched`);\n            fetching = true;\n            this.setState({\n              timeLine: res,\n            });\n          });\n      }, 5000);\n\n      setTimeout(() => {\n        console.log(`fetching deleted list soon`);\n        fetch(\"/deletedlisting\")\n          .then((res) => res.json())\n          .then((res) => {\n            if (res && res.length > 0) {\n              res.sort(function (a, b) {\n                const uploadTimeA = new Date(a.time);\n                const uploadTimeB = new Date(b.time);\n                return uploadTimeB - uploadTimeA;\n              });\n              this.setState({\n                deletedArray: res,\n              });\n            }\n          });\n      }, 5000);\n\n      setTimeout(() => {\n        let defunctArray = this.state.timeLine.map((item, index) => {\n          const uploadTime = new Date(item.time);\n          uploadTime.setMinutes(uploadTime.getMinutes() + item.time_limit_min);\n          let difference = +uploadTime - +new Date();\n          if (difference < 0) {\n            return item;\n          }\n        });\n        let newArray = defunctArray.filter((item) => {\n          return item;\n        });\n        console.log(`deleting soon`);\n        fetch(\"/tidyuplisting\", {\n          method: \"POST\",\n          headers: {\n            \"Content-Type\": \"application/json\",\n          },\n          body: JSON.stringify({ toBeDeleted: newArray }),\n        })\n          .then((res) => res.text())\n          .then((res) => {\n            console.log(res);\n          });\n      }, 10000);\n    }\n  };\n  render() {\n    let Array = this.state.timeLine.map((item, index) => {\n      const uploadTime = new Date(item.time);\n      uploadTime.setMinutes(uploadTime.getMinutes() + item.time_limit_min);\n      let difference = +uploadTime - +new Date();\n      if (difference > 0) {\n        return item;\n      }\n    });\n    let nArray = Array.filter((item) => {\n      return item;\n    });\n\n    nArray.sort(function (a, b) {\n      const uploadTimeA = new Date(a.time);\n      uploadTimeA.setMinutes(uploadTimeA.getMinutes() + a.time_limit_min);\n      const uploadTimeB = new Date(b.time);\n      uploadTimeB.setMinutes(uploadTimeB.getMinutes() + b.time_limit_min);\n      return uploadTimeA - uploadTimeB;\n    });\n    // console.log(newerArray, `before splice`)\n    if (nArray.length > 20) {\n      nArray.splice(19, nArray.length - 20);\n    }\n    let merchantCard = nArray.map((eachCard, index) => {\n      const discount =\n        ((eachCard.unit_price - eachCard.price_floor) / eachCard.unit_price) *\n        100;\n      let path = \"/\" + eachCard.merchant_id;\n      return (\n        <Link class=\"col-lg-4 col-md-6 mb-4\" to={path}>\n          <EachMerchant\n            className=\"card h-100\"\n            key={index}\n            duration={eachCard.time_limit_min}\n            time={eachCard.time}\n            merchant_Id={eachCard.merchant_id}\n            what={this.testing}\n          >\n            <img\n              class=\"card-img-top\"\n              src=\"https://picsum.photos/700/400\"\n              alt=\"\"\n            />\n            <h4>\n              {eachCard.name} {discount}%\n            </h4>\n            <p class=\"card-text\">Lorem ipsum dolor sit amet</p>\n          </EachMerchant>\n        </Link>\n      );\n    });\n    // console.log(newerArray, `After splice`)\n    let deletedMerchantCard = this.state.deletedArray.map((eachCard, index) => {\n      const discount =\n        ((eachCard.unit_price - eachCard.price_floor) / eachCard.unit_price) *\n        100;\n      let path = \"/\" + eachCard.merchant_id;\n      return (\n        <Link class=\"col-lg-4 col-md-6 mb-4\" to={path}>\n          <div className=\"card h-100\">\n            <img\n              class=\"card-img-top\"\n              src=\"https://picsum.photos/700/400\"\n              alt=\"\"\n            />\n            <div className=\"card-body\">\n              <h4 class=\"card-title\">{eachCard.Merchant}</h4>\n              <div>{eachCard.name}</div>\n              <div>up to{discount}%</div>\n            </div>\n          </div>\n        </Link>\n      );\n    });\n    const routeArray = nArray.map((eachCard, index) => {\n      let path = \"/\" + eachCard.merchant_id;\n      return (\n        <Route\n          path={path}\n          render={() => (\n            <ListingContainer\n              listing_id={eachCard.listing_id}\n              merchant_id={eachCard.merchant_id}\n              stripper={this.props.stripper}\n              user_id={this.props.user_id}\n            />\n          )}\n        />\n      );\n    });\n    return (\n      <>\n        <nav class=\"navbar navbar-expand-lg navbar-dark bg-dark fixed-top\">\n          <div class=\"container\">\n            <a class=\"navbar-brand\" href=\"#\">\n              Start Bootstrap\n            </a>\n            <button\n              class=\"navbar-toggler\"\n              type=\"button\"\n              data-toggle=\"collapse\"\n              data-target=\"#navbarResponsive\"\n              aria-controls=\"navbarResponsive\"\n              aria-expanded=\"false\"\n              aria-label=\"Toggle navigation\"\n            >\n              <span class=\"navbar-toggler-icon\"></span>\n            </button>\n            <div class=\"collapse navbar-collapse\" id=\"navbarResponsive\">\n              <ul class=\"navbar-nav ml-auto\">\n                <li class=\"nav-item active\">\n                  <Link to=\"/Timeline\">\n                    Timeline<span class=\"sr-only\">(current)</span>\n                  </Link>\n                </li>\n                <li class=\"nav-item\">\n                  <Link to=\"/Orderhistory\">Order history</Link>\n                </li>\n                <li class=\"nav-item\">\n                  <Link to=\"/ByDistance\">Distance</Link>\n                </li>\n                <li class=\"nav-item\">\n                  <Link to=\"/ByDiscount\">Discount</Link>\n                </li>\n              </ul>\n              <button onClick={this.props.onLogout}>Log out</button>\n            </div>\n          </div>\n        </nav>\n        <div className=\"container\">\n          <div\n            id=\"carouselExampleIndicators\"\n            class=\"carousel slide my-4\"\n            data-ride=\"carousel\"\n          >\n            <ol class=\"carousel-indicators\">\n              <li\n                data-target=\"#carouselExampleIndicators\"\n                data-slide-to=\"0\"\n                class=\"active\"\n              ></li>\n              <li\n                data-target=\"#carouselExampleIndicators\"\n                data-slide-to=\"1\"\n              ></li>\n              <li\n                data-target=\"#carouselExampleIndicators\"\n                data-slide-to=\"2\"\n              ></li>\n            </ol>\n            <div class=\"carousel-inner\" role=\"listbox\">\n              <div class=\"carousel-item active\">\n                <img\n                  class=\"d-block img-fluid\"\n                  src=\"https://picsum.photos/1110/350\"\n                  alt=\"First slide\"\n                />\n              </div>\n              <div class=\"carousel-item\">\n                <img\n                  class=\"d-block img-fluid\"\n                  src=\"https://picsum.photos/1110/350\"\n                  alt=\"Second slide\"\n                />\n              </div>\n              <div class=\"carousel-item\">\n                <img\n                  class=\"d-block img-fluid\"\n                  src=\"https://picsum.photos/1110/350\"\n                  alt=\"Third slide\"\n                />\n              </div>\n            </div>\n          </div>\n          <div>\n            <select>\n              <option value=\"Time\">Time Left</option>\n              <option value=\"Discount\">Discount</option>\n              <option value=\"Distance\">Distance</option>\n            </select>\n          </div>\n          <main>\n            <Switch>\n              {routeArray}\n              <Route\n                path=\"/Orderhistory\"\n                render={() => <OrderHistory user_id={this.props.user_id} />}\n              />\n              {/* <Route path=\"/ByCategory\" render={\n                            () => <ByCategory data={this.state.timeLine} lon={this.props.lon} lat={this.props.lat} />\n                        } /> */}\n              <Route\n                path=\"/ByDistance\"\n                render={() => (\n                  <ByDistance lon={this.props.lon} lat={this.props.lat} />\n                )}\n              />\n              <Route\n                path=\"/ByDiscount\"\n                render={() => (\n                  <ByDiscount lon={this.props.lon} lat={this.props.lat} />\n                )}\n              />\n              <Route\n                path=\"/\"\n                render={() => (\n                  <>\n                    <h1>Ongoing Deals</h1>\n                    <div className=\"row\">\n                      {this.state.status ? merchantCard : <div>sortedCard</div>}\n                    </div>\n                    <h1>Expired Deals</h1>\n                    <div className=\"row\">{deletedMerchantCard}</div>\n                  </>\n                )}\n              />\n            </Switch>\n          </main>\n        </div>\n      </>\n    );\n  }\n}\n\n//\n// First Option\n// 1) Starting Price is our price ceiling\n// 2) When timeleft = time left / 2\n// 3) price will be price ceiling + price floor /2\n// 4) taking time left split into 4 Segements\n//\n// segement1\n//   price ceiling -  80/100 * price difference = 6.54\n// segment2\n//   price ceiling - 60/100 * price difference = 6.28\n// segment3\n//   price ceiling - 40/100 * price difference = 6.02\n// segment4\n// if 10% or>\n//     price ceiling - 20/100 * price difference =5.76\n//     else\n//     price floor\n//     else (based on time set to price floor)\n// up 7\n// price ceiling 6.80\n// price floor   5.50         price difference 1.30 0-100%\n// price c\n// hard code average time on item creation into the database\n//\n//                                                       qty is static in our DB, possibly carry out second fetch on orders to sum qty to     ////////////                                                       calcualte OR write into DB a new column to keep adding to check sale\n// average time taken to sell an item  get current time - upload time = price difference divide by uploaded qty - remaining qty  ( ) <---------------------how?\n// compare it to the \"estimated time\" to sell 1hr 10\n//\n// if more/ less\n// metric duration = time taken to sell out / tiem set by the user\n// 10 items 0:00\n// 9items   0:06\n// 8         0:12<-------  average time setimt time_limit_min /items\n//\n//\n// 1 hour\n//\n"]},"metadata":{},"sourceType":"module"}