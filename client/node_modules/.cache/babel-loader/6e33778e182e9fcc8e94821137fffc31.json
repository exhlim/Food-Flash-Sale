{"ast":null,"code":"var _jsxFileName = \"/home/rlyz/wdi/sei-24-project-3/client/src/Components/User/IndivStore/ListingContainer.js\";\nimport React from 'react';\nimport IndivListing from './IndivListing';\nimport Basket from './Basket';\nimport CheckoutForm from './CheckoutForm';\nimport PaymentOverlay from './PaymentOverlay';\nimport { Elements } from '@stripe/react-stripe-js';\nimport { loadStripe } from '@stripe/stripe-js';\nexport default class ListingContainer extends React.Component {\n  constructor(props) {\n    //mounting\n    super(props);\n    console.log(\"----inside Listing constructor\");\n    this.state = {\n      merchant_id: props.merchant_id,\n      merchant_name: \"\",\n      merchant_img: \"\",\n      html: [],\n      result: [],\n      cart: [],\n      viewCart: false,\n      checkout: false,\n      clicked: 0\n    };\n    this.addToCart = this.addToCart.bind(this);\n    this.navigateTo = this.navigateTo.bind(this);\n    this.handleAddToCart = this.handleAddToCart.bind(this);\n    this.handleRemoveFromCart = this.handleRemoveFromCart.bind(this);\n    this.handleCheckOut = this.handleCheckOut.bind(this);\n  } //\n  //payment click handlling\n\n\n  handleCheckOut() {\n    this.setState({\n      checkout: true\n    });\n  } //delete from cart\n\n\n  handleRemoveFromCart(e, item) {\n    this.setState(state => {\n      const cart = state.cart.filter(element => element.name != item.name);\n      localStorage.setItem('cart', cart);\n      return {\n        cart\n      };\n    });\n  } //add to cart button\n\n\n  addToCart(e, addToCart) {\n    console.log(addToCart);\n    this.setState(prevState => ({\n      cart: [...prevState.cart, addToCart]\n    }));\n  } // view cart button\n\n\n  navigateTo() {\n    if (this.state.cart.length > 0) {\n      this.setState({\n        viewCart: !this.state.viewCart\n      });\n    }\n  }\n\n  handleAddToCart(e, product) {\n    console.log(product);\n    this.setState(state => {\n      const cart = state.cart;\n      let productAlreadyInCart = false;\n      console.log(cart);\n      cart.forEach(item => {\n        if (item.name === product.name && item.count / 2 < item.quantity) {\n          productAlreadyInCart = true;\n          item.count++;\n          console.log(item.count);\n        }\n      });\n\n      if (!productAlreadyInCart) {\n        cart.push({ ...product,\n          count: 1\n        });\n      }\n\n      localStorage.setItem(\"cart\", JSON.stringify(cart));\n      return cart;\n      console.log(this.state.cart);\n    });\n  } //when state is changed, FETCH results from aPI\n  //side effects ie: HTTP requests are allowed here\n\n\n  componentDidMount() {\n    fetch(`/indivshop/${this.props.listing_id}`).then(res => res.json()).then(res => {\n      console.log(res);\n      this.setState({\n        result: res,\n        html: this.format(res),\n        merchant_name: res[0].name\n      });\n    });\n  } //update and re-render once checkout is clicked and this.state.checkout=true;\n\n\n  componentDidUpdate(prevProps, prevState) {\n    if (prevState.checkout !== this.state.checkout) {\n      return /*#__PURE__*/React.createElement(PaymentOverlay, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 115,\n          columnNumber: 20\n        }\n      });\n    }\n  } //helper functions\n  //take the res.json and convert into nice HTML\n\n\n  format(array) {\n    return array.map((item, index) => {\n      let item_name = item.item_name;\n      let quantity = item.quantity;\n      let discPrice = item.price_ceiling;\n      let originalPrice = item.unit_price;\n      let discount = (originalPrice - discPrice) / originalPrice;\n      let merchant_name = item.name;\n      let cuisine = item.cuisine;\n      let listing_id = item.listing_id;\n      let merchant_id = item.merchant_id;\n      return /*#__PURE__*/React.createElement(\"div\", {\n        key: index,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 136,\n          columnNumber: 20\n        }\n      }, /*#__PURE__*/React.createElement(IndivListing, {\n        item_name: item_name,\n        quantity: quantity,\n        discPrice: discPrice,\n        originalPrice: originalPrice,\n        discPrice: discPrice,\n        discount: discount,\n        merchant_name: merchant_name,\n        cuisine: cuisine,\n        onClick: this.handleAddToCart,\n        listing_id: listing_id,\n        merchant_id: merchant_id,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 137,\n          columnNumber: 17\n        }\n      }));\n    });\n  }\n\n  render() {\n    const stripePromise = loadStripe(this.props.stripper); // if (this.state.checkout) {\n    //     return (\n    //         <div><PaymentOverlay cart={this.state.cart} stripper={this.props.stripper} /></div>\n    //     )\n    // }\n\n    let data = {};\n\n    if (this.state.cart[0]) {\n      data = {\n        merchant_id: this.state.cart[0].merchant_id,\n        //user_id:\n        name: this.state.cart[0].name,\n        user_id: this.state.cart[0].user_id,\n        listing_id: this.state.cart[0].listing_id,\n        price: this.state.cart[0].price,\n        quantity: this.state.cart[0].count / 2,\n        revenue: this.state.cart[0].count / 2 * this.state.cart[0].price\n      };\n    }\n\n    return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"h1\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 171,\n        columnNumber: 17\n      }\n    }, \"You are viewing deals from \", this.state.merchant_name), /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 172,\n        columnNumber: 17\n      }\n    }), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"ListItems\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 173,\n        columnNumber: 17\n      }\n    }, this.state.html), /*#__PURE__*/React.createElement(\"button\", {\n      onClick: this.navigateTo,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 176,\n        columnNumber: 17\n      }\n    }, \"View Cart \", this.state.cart.length), this.state.viewCart ? /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 179,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 180,\n        columnNumber: 25\n      }\n    }, /*#__PURE__*/React.createElement(\"h1\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 181,\n        columnNumber: 29\n      }\n    }, \"Order Summary\"), /*#__PURE__*/React.createElement(\"table\", {\n      style: {\n        maxWidth: \"300px\",\n        margin: \"0 auto\"\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 182,\n        columnNumber: 29\n      }\n    }, /*#__PURE__*/React.createElement(\"tr\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 183,\n        columnNumber: 33\n      }\n    }, /*#__PURE__*/React.createElement(\"th\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 184,\n        columnNumber: 37\n      }\n    }, \"Item Name\"), /*#__PURE__*/React.createElement(\"th\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 185,\n        columnNumber: 37\n      }\n    }, \"Quantity\"), /*#__PURE__*/React.createElement(\"th\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 186,\n        columnNumber: 37\n      }\n    }, \"Total\")), /*#__PURE__*/React.createElement(\"tr\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 188,\n        columnNumber: 33\n      }\n    }, /*#__PURE__*/React.createElement(\"td\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 189,\n        columnNumber: 37\n      }\n    }, this.state.cart[0].name), /*#__PURE__*/React.createElement(\"td\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 190,\n        columnNumber: 37\n      }\n    }, this.state.cart[0].count / 2), /*#__PURE__*/React.createElement(\"td\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 191,\n        columnNumber: 37\n      }\n    }, \"Total: $\", this.state.cart[0].count / 2 * this.state.cart[0].price))), /*#__PURE__*/React.createElement(Elements, {\n      stripe: stripePromise,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 194,\n        columnNumber: 29\n      }\n    }, /*#__PURE__*/React.createElement(CheckoutForm, {\n      data: data,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 194,\n        columnNumber: 62\n      }\n    })))) : null);\n  }\n\n}","map":{"version":3,"sources":["/home/rlyz/wdi/sei-24-project-3/client/src/Components/User/IndivStore/ListingContainer.js"],"names":["React","IndivListing","Basket","CheckoutForm","PaymentOverlay","Elements","loadStripe","ListingContainer","Component","constructor","props","console","log","state","merchant_id","merchant_name","merchant_img","html","result","cart","viewCart","checkout","clicked","addToCart","bind","navigateTo","handleAddToCart","handleRemoveFromCart","handleCheckOut","setState","e","item","filter","element","name","localStorage","setItem","prevState","length","product","productAlreadyInCart","forEach","count","quantity","push","JSON","stringify","componentDidMount","fetch","listing_id","then","res","json","format","componentDidUpdate","prevProps","array","map","index","item_name","discPrice","price_ceiling","originalPrice","unit_price","discount","cuisine","render","stripePromise","stripper","data","user_id","price","revenue","maxWidth","margin"],"mappings":"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","sourcesContent":["import React from 'react';\nimport IndivListing from './IndivListing';\nimport Basket from './Basket';\nimport CheckoutForm from './CheckoutForm';\nimport PaymentOverlay from './PaymentOverlay';\nimport { Elements } from '@stripe/react-stripe-js';\nimport { loadStripe } from '@stripe/stripe-js'\n\nexport default class ListingContainer extends React.Component {\n    constructor(props) {\n        //mounting\n        super(props)\n        console.log(\"----inside Listing constructor\")\n\n        this.state = {\n            merchant_id: props.merchant_id,\n            merchant_name: \"\",\n            merchant_img: \"\",\n            html: [],\n            result: [],\n            cart: [],\n            viewCart: false,\n            checkout: false,\n            clicked: 0\n        }\n\n        this.addToCart = this.addToCart.bind(this);\n        this.navigateTo = this.navigateTo.bind(this)\n        this.handleAddToCart = this.handleAddToCart.bind(this)\n        this.handleRemoveFromCart = this.handleRemoveFromCart.bind(this);\n        this.handleCheckOut = this.handleCheckOut.bind(this)\n\n    }\n    //\n\n\n\n\n    //payment click handlling\n    handleCheckOut() {\n        this.setState({ checkout: true })\n\n    }\n\n\n\n\n\n    //delete from cart\n    handleRemoveFromCart(e, item) {\n        this.setState(state => {\n            const cart = state.cart.filter(element => element.name != item.name);\n            localStorage.setItem('cart', cart);\n            return { cart }\n        })\n    }\n\n\n    //add to cart button\n    addToCart(e, addToCart) {\n        console.log(addToCart)\n        this.setState((prevState) =>\n            ({ cart: [...prevState.cart, addToCart] }))\n    }\n\n\n    // view cart button\n    navigateTo() {\n        if (this.state.cart.length > 0) {\n            this.setState({ viewCart: !this.state.viewCart })\n        }\n    }\n\n    handleAddToCart(e, product) {\n        console.log(product)\n\n        this.setState(state => {\n            const cart = state.cart;\n            let productAlreadyInCart = false;\n            console.log(cart)\n            cart.forEach(item => {\n                if (item.name === product.name && item.count / 2 < item.quantity) {\n                    productAlreadyInCart = true;\n                    item.count++;\n                    console.log(item.count)\n                }\n            });\n            if (!productAlreadyInCart) {\n                cart.push({ ...product, count: 1 })\n            }\n            localStorage.setItem(\"cart\", JSON.stringify(cart));\n            return cart;\n            console.log(this.state.cart)\n        })\n    }\n\n\n\n    //when state is changed, FETCH results from aPI\n    //side effects ie: HTTP requests are allowed here\n    componentDidMount() {\n        fetch(`/indivshop/${this.props.listing_id}`)\n            .then(res => res.json())\n            .then(res => {\n                console.log(res)\n                this.setState({ result: res, html: this.format(res), merchant_name: res[0].name })\n            })\n    }\n\n\n    //update and re-render once checkout is clicked and this.state.checkout=true;\n\n    componentDidUpdate(prevProps, prevState) {\n        if (prevState.checkout !== this.state.checkout) {\n            return <PaymentOverlay />\n        }\n    }\n\n\n\n    //helper functions\n\n    //take the res.json and convert into nice HTML\n    format(array) {\n        return array.map((item, index) => {\n            let item_name = item.item_name;\n            let quantity = item.quantity;\n            let discPrice = item.price_ceiling;\n            let originalPrice = item.unit_price;\n            let discount = (originalPrice - discPrice) / originalPrice\n            let merchant_name = item.name;\n            let cuisine = item.cuisine;\n            let listing_id = item.listing_id;\n            let merchant_id = item.merchant_id\n\n            return <div key={index}>\n                <IndivListing item_name={item_name} quantity={quantity} discPrice={discPrice} originalPrice={originalPrice} discPrice={discPrice} discount={discount} merchant_name={merchant_name} cuisine={cuisine} onClick={this.handleAddToCart} listing_id={listing_id} merchant_id={merchant_id} />\n\n            </div>\n        })\n    }\n\n\n    render() {\n        const stripePromise = loadStripe(this.props.stripper)\n        // if (this.state.checkout) {\n        //     return (\n        //         <div><PaymentOverlay cart={this.state.cart} stripper={this.props.stripper} /></div>\n\n        //     )\n        // }\n\n        let data = {}\n\n\n        if (this.state.cart[0]) {\n            data = {\n                merchant_id: this.state.cart[0].merchant_id,\n                //user_id:\n                name: this.state.cart[0].name,\n                user_id: this.state.cart[0].user_id,\n                listing_id: this.state.cart[0].listing_id,\n                price: this.state.cart[0].price,\n                quantity: this.state.cart[0].count / 2,\n                revenue: this.state.cart[0].count / 2 * this.state.cart[0].price\n            }\n        }\n        return (\n            <>\n\n                <h1>You are viewing deals from {this.state.merchant_name}</h1>\n                <br />\n                <div className=\"ListItems\" >\n                    {this.state.html}\n                </div>\n                <button onClick={this.navigateTo}>View Cart {this.state.cart.length}</button>\n\n                {this.state.viewCart ?\n                    <div>\n                        <div>\n                            <h1>Order Summary</h1>\n                            <table style={{ maxWidth: \"300px\", margin: \"0 auto\" }}>\n                                <tr>\n                                    <th>Item Name</th>\n                                    <th>Quantity</th>\n                                    <th>Total</th>\n                                </tr>\n                                <tr>\n                                    <td>{this.state.cart[0].name}</td>\n                                    <td>{this.state.cart[0].count / 2}</td>\n                                    <td>Total: ${this.state.cart[0].count / 2 * this.state.cart[0].price}</td>\n                                </tr>\n                            </table>\n                            <Elements stripe={stripePromise}><CheckoutForm data={data}></CheckoutForm></Elements>\n                        </div>\n                    </div> : null}\n            </>\n        )\n\n\n\n\n\n    }\n}\n\n\n\n"]},"metadata":{},"sourceType":"module"}